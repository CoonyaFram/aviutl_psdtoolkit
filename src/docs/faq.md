# エラーメッセージが表示される

拡張編集で新規プロジェクトを作成したときなどに

```
＊＊＊　エラーメッセージ　＊＊＊

failed to execute: script\PSDToolkit\PSDToolKit.exe
Failed to execute: 2

Please check whether the antivirus software is blocking program execution.
アンチウィルスソフトがプログラム実行を阻害していないか確認してください。
```

上記のようなメッセージが出る場合は、`script\PSDToolkit\PSDToolKit.exe` が何らかの理由でブロックされているのが原因です。  
AviUtl を `C:\AviUtl\aviutl.exe` あたりに置いて起動するか、試してみてください。

また、もしアンチウィルスソフトが警告を出す場合は、究極的には開発者を信じるかアンチウィルスソフトを信じるかの2択になります。

開発者を信用しない場合は自分でソースコードを元にプログラムをコンパイルして使用するか、使用自体を諦めてください。  
信用してもいい場合はアンチウィルスソフトで除外するなどの設定を行ってください。

# 拡張編集にファイルが投げ込めない

拡張編集のタイムライン上にエクスプローラーから PSD ファイルなどをドラッグ＆ドロップで読み込もうとした時に、マウスカーソルが 🚫 になって投げ込めないことがあります。

これは大抵の場合 AviUtl が管理者権限など、特殊な権限で動作してしまっているのが原因です。  
エクスプローラーで `aviutl.exe` や `script\PSDToolKit\PSDToolKit.exe` のプロパティを開いて、管理者権限で実行するような設定が有効になってしまっていないか確認してください。

# レイヤーが消えない / 複数表示される / 指定していないレイヤーが出る

[ラジオボタン化](https://oov.github.io/psdtool/manual.html#original-feature-asterisk)されているレイヤーを操作している場合や[シンプルビュー](pfv.md#PSDToolKit_で_PSDTool_のお気に入りを読み込む)を使って設定している場合はグループ内で単独のパーツのみを正しく表示できますが、それらの機能に対応していない PSD ファイルでは、例えば目パチで目のパーツが複数同時に表示されたりすることがあります。

このようなときは、PSD ファイルのアイテムに **目を全て非表示にしたもの** を `送る` ボタンで割り当てておけば問題なく利用することができます。

# 設定が保存されない

![`パラメーター設定` ダイアログ](assets/faq-paramdlg.png)

拡張編集の `パラメータ設定` ダイアログは、**全ての設定値の合計**が255バイトを超えると上手く保存されなくなり、**後ろの方に書いた内容が消えてしまう**ようになります。

この255バイトには入力したテキストだけでなくスクリプトとして必要な文字も含まれており、実際にはもっと少ない文字数しか記述できません。

これは拡張編集における仕様であるため基本的に回避することができませんが、このダイアログを使わずに設定する [同じ階層のレイヤーをエクスポート](tutorial.md#*.anm_ファイルを作成する) ならこの制限を回避することができます。

## スクリプト制御で目パチを行う

`目パチ` や `口パク` のみを使いたいだけの場合は、`アニメーション効果` の代わりに `スクリプト制御` を使う方法もあり、これなら1024バイトまで入力することができます。

例えば[目パチ用フォーム](psd.md#目パチ_を_Lua_スクリプトから使う)で使いたい内容を組み立ててクリップボードにコピーし、

```lua
PSD:addstate(ここに組み立てた内容をペースト)
```

というスクリプトを記述すると、`目パチ` のアニメーション効果と全く同じように使うことができます。

![`スクリプト制御` 使用例](assets/faq-blinker.png)

# 項目名の一部が文字化けする

アニメーション効果に割り当てたりエクスポートした項目名で、

`v1.!%xQ情/!目/*にっこり`

のように、一部がおかしな文字になることがありますが、**これは正常な動作** です。

- 一部の記号が含まれている
- `Shift_JIS` では使えない文字が含まれている
- `ソ` / `十` / `表` / `能` といったいわゆる「ダメ文字」が含まれている

上記のいずれかに該当する場合に、トラブルを回避するためにそれらを使わない表現に変換しています。

# アニメーションの動きが変

AviUtl のプレビュー再生は描画が間に合わない時はコマ飛びし、コマ飛びによって描画内容自体が変わってしまうこともあるためフレーム単位での正確な確認には向きません。

きちんと動作しているかを確認したい場合は動画ファイルへの書き出しや[`拡張編集RAMプレビュー`](preview.md#拡張編集RAMプレビュー)を利用して、コマ飛びがない状態で確認してみてください。

# 口パクがほとんど開きっぱなしになる / ほとんど開かない

音声に対して `口パク準備` の設定が適切ではない場合、過剰に口が開きっぱなしになったり、ほとんど開かないなどという状況に陥ることがあります。

初期値は多くの場合に上手く母音が捉えられ小さい音声に対しても反応する設定になっていますが、対象が音声だけではないファイルだったり、ノイズが多いファイルなどの場合には設定を見直さなければ上手く動かないでしょう。

個別のファイルを調整する場合は `口パク準備` のスライダーを、全体に対して調整する場合は `PSD ファイルオブジェクト` 側にある `ls_locut`/`ls_hicut`/`ls_threshold` を使用します。

# 口パクを母音に合わせて動かしても違和感がある

母音の形に合わせてアニメーションをするのは比較的難しく、期待しているほど上手く動かないこともあります。

手間をいとわず細かい制御をしたい場合は [`*.lab` ファイルを直接拡張編集のタイムライン上に投げ込む](gcmzdrops.md#*.lab_ファイル) のがオススメです。  
この方法なら音素毎のタイミングも含めて手動で調整できるようになるので、後から微調整がタイムライン上で行なえます。

# `attempt to call global 'type'(a XXXXX value)` というエラーが表示される

`TAぽよよ～んと登場` など一部のスクリプトには Lua スクリプトに標準で用意されている `type` 関数を上書きして壊してしまう深刻なバグがあります。

PSDToolKit では `type` 関数が必要な箇所があり、このような問題があるスクリプトを同時に使用することはできません。

この問題に対しては以下の対策方法があります。

- **問題が起きるスクリプトファイルを編集する**  
問題が起きるスクリプトファイルをテキストエディタで開くと、例えば `type=0` のように `type` という名前が出てくる場所が数か所あるはずなので、これを全て `typ` などの別の名前に置換してください。  
- **問題が起きるスクリプトを使わない**  
そのスクリプトを使わない場合は問題が発生しません。
- **PSDToolKit の使用を諦める**  
`type` が破壊されると PSDToolKit 以外でも問題が起きる可能性はありますが、取りあえず PSDToolKit を使わないことで現在直面している問題を回避することができます。

この問題に対する PSDToolKit としての方針をより正確に書くと、PSDToolKit 単体としては独自に同等機能を用意することで問題を回避することも不可能ではありませんが、その対応方法は問題の先延ばしに過ぎず、より発見しづらい状況下で問題が起こることも考えられるため、きちんと根底にある問題を解決すべきだということでこちら側で対策は行っていません。