# `attempt to call global 'type'(a XXXXX value)` というエラーが表示される

`TAぽよよ～んと登場` など一部のスクリプトには Lua スクリプトに標準で用意されている `type` 関数を上書きして壊してしまう深刻なバグがあります。

PSDToolKit では `type` 関数が必要な箇所があり、このような問題があるスクリプトを同時に使用することはできません。

この問題に対しては以下の対策方法があります。

- **問題が起きるスクリプトファイルを編集する**  
問題が起きるスクリプトファイルをテキストエディタで開くと、例えば `type=0` のように `type` という名前が出てくる場所が数か所あるはずなので、これを全て `typ` などの別の名前に置換してください。  
- **問題が起きるスクリプトを使わない**  
そのスクリプトを使わない場合は問題が発生しません。
- **PSDToolKit の使用を諦める**  
`type` が破壊されると PSDToolKit 以外でも問題が起きる可能性はありますが、取りあえず PSDToolKit を使わないことで現在直面している問題を回避することができます。

この問題に対する PSDToolKit としての方針をより正確に書くと、PSDToolKit 単体としては独自に同等機能を用意することで問題を回避することも不可能ではありませんが、その対応方法は問題の先延ばしに過ぎず、より発見しづらい状況下で問題が起こることも考えられるため、きちんと根底にある問題を解決すべきだということでこちら側で対策は行っていません。

# シンプルビューを作らずに目パチや口パクを行うには？

シンプルビューを作らずにこれを実現する方法は現在ありません。

シンプルビューなしで同等の機能を実現するためには、例えば目パチの場合、概ね以下のような操作を行う必要があります。

1. 立ち絵に存在する全ての目のレイヤーを非表示にする
2. 表示したい目のレイヤーを表示状態にする

立ち絵に目が10パターンあるなら 1 のステップで10個のレイヤーを非表示にする必要があり、どのレイヤーなのかを明確に指定するためには親階層のフォルダー名なども合わせて指定しなければなりません。つまり、例えば `頭/表情/目/ノーマル` のようなものを10個指定する必要があり、その後表示するレイヤーを指定するためには最低でも「閉じ」「開き」の2個以上のレイヤーを追加で指定しなければならないかも知れません。

参考として挙げたレイヤー名 `頭/表情/目/ノーマル` は Shift_JIS で19バイトあり、AviUtl の設定ダイアログは255バイトの上限があるため、レイヤーが全て同じ名前だったと仮定すると13個以上の指定はできません。また、このバイト数には Lua スクリプトとして必要になる変数名や `=` 記号などの文字も含まれるため、実際にはもっと少ないバイト数しか使えません。

当然ながらレイヤー名がもっと長いケースや目のパターン数がもっと多いことは往々にしてあり、このように画像内のレイヤー数やレイヤー名に依存した設定を AviUtl に書き込むのは「画像によっては動作しない」という状況を頻繁に生み出してしまうことになるため、PSDToolKit ではシンプルビューを使わない表情切り替えなどをサポートしていません。