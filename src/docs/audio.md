# 音声について

音声は PSD ファイルとは直接関係あるものではありませんが、PSD ファイルを使った動画制作では口パク用の音声などで処理機能が必要になることもあるため、PSDToolKit には音声処理に関する補助機能があります。

拡張編集では音声に対して行える操作は少なく、オーディオを扱うことを主軸としたソフトのようにイコライザーなどを使うことはできませんが、イコライザーやコンプレッサーなどで音量をコントロールできるとバランスの取れた動画が作りやすくなります。

また、動画を編集する上で複数の音声を合成していく場合、音割れ防止用にマスターにリミッターを入れたりできると便利です。

PSDToolKit では `チャンネルストリップ` / `Aux1 チャンネルストリップ` / `マスターチャンネルストリップ` という、上記を実現するための AviUtl プラグインを提供しています。

# `チャンネルストリップ`

`チャンネルストリップ` は拡張編集上の音声に対してエフェクターなどを提供するフィルタオブジェクトです。

`チャンネルストリップ` は拡張編集の右クリックメニューから `フィルタオブジェクトの追加`→`チャンネルストリップ` で挿入できます。

![`チャンネルストリップ` のプロパティ](assets/audio-cs.png)

プロパティ名|説明
---|---
`ID`|チャンネルストリップを識別する番号を指定します。<br>チャンネルストリップを使用する時は、同じ時間軸で重複しない `0` 以上の `ID` を指定する必要があります。<br>つまり縦に `ID: 0` が２つあるのはまずいですが、横に `ID: 0` が２つあるのは問題ありません。
`入力音量`|エフェクターに通す前の音量を指定します。
`遅延`|音声を遅らせる時間をミリ秒でします。
`EQ LoFreq`|イコライザーで音量調整したい周波数帯を指定します。
`EQ LoGain`|`EQ LoFreq` で指定した周波数帯の音量を調整します。
`EQ HiFreq`|イコライザーで音量調整したい周波数帯を指定します。
`EQ HiGain`|`EQ HiFreq` で指定した周波数帯の音量を調整します。
`C Thresh`|コンプレッサーのスレッショルド（どの程度の大きさを超えたらコンプレッサーで圧縮するか）を指定します。
`C Ratio`|コンプレッサーのレシオ（どの程度圧縮するか）を指定します。
`C Attack`|コンプレッサーのアタック（どのぐらいの速さで音量が圧縮されるか）を指定します。
`C Release`|コンプレッサーのリリース（どのぐらいの速さで音量が戻るか）を指定します。
`Aux1Send`|`Aux1 チャンネルストリップ`に送る音の大きさを指定します。
`出力音量`|エフェクターに通した後の音量を指定します。

全ての設定は初期値では何も行わないようになっています。

なお AviUtl のメインメニューから `設定`→`チャンネルストリップの設定` を選ぶと、現在時刻における設定値を単位付きで確認できます。

![`チャンネルストリップ` の設定ウィンドウ](assets/audio-cs2.png)

## `チャンネルストリップ` の使い方

チャンネルストリップは設置した場所よりも上に置いたオーディオが処理対象になります。

また、複数のチャンネルストリップを配置したときは、前のチャンネルストリップから次のチャンネルストリップまでの間に設置されたオーディオが処理対象になります。

![`チャンネルストリップ` の影響範囲](assets/audio-cs3.png)

このように `チャンネルストリップ` を３つ設定した場合、この黄色く着色したゾーンがそれぞれの `チャンネルストリップ` の影響範囲になります。

## 音声ファイル側で音量を大きくしない

チャンネルストリップを使うときは、音声ファイル側で音量を大きくするべきではありません。  
（小さくするのは問題ありません）

![`音声ファイル` の音量](assets/audio-cs4.png)

このパラメータは、音を大きくする用途で使うとピークを超えた時に音が割れてしまいます。

`チャンネルストリップ` の `入力音量` や `出力音量` では内部では 32bit float で処理しているため、音声ファイル側だと音が割れるほどの音量になっても、その時点で音が割れることはありません。

また、`チャンネルストリップ` が処理したそれぞれの音声は最終的には合成されますが、その時点で音が割れるほど大きい場合は `リミッター` エフェクタが適切に音量を絞るため、相対的に他の音が小さくなることはあっても基本的には音が割れない仕組みになっています。

# `Aux1 チャンネルストリップ`

`Aux1 チャンネルストリップ` はセンドエフェクトの仕組みを実現するためのフィルタオブジェクトです。

現在は実験的なリバーブのみが実装されています。

![`Aux1 チャンネルストリップ` のプロパティ](assets/audio-a1cs.png)

プロパティ名|説明
---|---
`R PreDly`|リバーブの残響が始まるまでの時間を指定した分だけ遅延させます。<br>大きな部屋では音が反射するまでの距離も遠くなるので、大きな部屋をシミュレートする場合はこの値を大きくします。
`R Decay`|リバーブの残響の長さです。
`R LPFreq`|リバーブの残響に設定するローパスフィルターの周波数を指定します。<br>この値を大きくすれば残響の音が明るく、小さくすれば暗くなります。
`R HPFreq`|リバーブの残響に設定するハイパスフィルターの周波数を指定します。<br>この値を大きくすれば残響の音が軽く、小さくすれば重くなります。

## 注意事項

`Aux1 チャンネルストリップ` は `音声波形表示` などと相性が悪く、残響の音がおかしくなりますが、これは仕様です。

`音声波形表示` など一部のフィルターは時間軸に対してバラバラにデータを返さなくてはいけなくなるため、現在の実装では綺麗に対処できなくなるためです。

## `Aux1 チャンネルストリップ` の使い方

まず `チャンネルストリップ` にある `Aux1Send` パラメーターを用いて、音声データを `Aux1 チャンネルストリップ` に対して送信します。

同じ時間軸上に `Aux1 チャンネルストリップ` を設置し、各種パラメーターを設定することでリバーブが利用可能になります。

# `マスターチャンネルストリップ`

`マスターチャンネルストリップ` は内部で自動的に使われているフィルタで、`チャンネルストリップ` で回収した各トラックのデータを `マスターチャンネルストリップ` が合成することでひとつの音声として出力します。

また、`マスターチャンネルストリップ` にはリミッターが内蔵されており、音が割れそうな時は全体の音量を下げることで音自体が割れるのを回避します。