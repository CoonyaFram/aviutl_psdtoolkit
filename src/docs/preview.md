# AviUtl のプレビューがガクガクする

AviUtl ではプレビュー再生時に動画の再生速度に対して描画が追いつかない時、遅れを取り戻すために一部のフレームをスキップして再生を続行します。

この現象が連続して起こると再生される映像は飛び飛びになりますが、それに伴ってスクリプト処理なども飛び飛びのフレームで行われてしまうため、結果的にプレビューでの確認は映像が飛ぶだけではなく、動画ファイルとして書き出した時と内容自体も異なってしまうことがあります。

これは AviUtl の仕様であるため基本的には回避が難しいので、一般的には短い区間を動画として書き出し、それを別のソフトなどで再生することで実際の映像を確認します。

PSDToolKit には `拡張編集RAMプレビュー` というプラグインが付属しており、空きメモリーに余裕のある動画制作環境の場合はこのプラグインを使うことにより多少作業効率を改善可能です。

# `拡張編集RAMプレビュー`

`拡張編集RAMプレビュー` は一時的にメモリー上に描画結果を溜め込み、後からそれを直接再生することにより描画負荷を削減し、コマ飛びを軽減した状態でプレビューを行うことができるプラグインです。

このプラグインはメモリーを大量に必要とするため、空きメモリーに余裕がない環境では上手くコマ飛びが解消されないことがあります。

## `拡張編集RAMプレビュー` の使い方

`拡張編集RAMプレビュー` は AviUtl のメインメニューより `設定`→`拡張編集RAMプレビューの設定` を選ぶと設定用のウィンドウが表示されます。

![`拡張編集RAMプレビュー` 設定](assets/rampreview.png)

機能名|説明
---|---
`通常`<br>`RAMプレビュー`|モード切り替え用のリストボックスです。<br>`RAMプレビュー` に切り替えると、事前に作成したキャッシュデータを元に動画を再生します。<br>`Ctrl + Shift + R` のショートカットキーでも切り替え可能です。
`選択範囲からキャッシュ作成`|AviUtl で選択されている範囲を元にしてキャッシュデータの作成を開始します。<br>キャッシュの作成が完了すると自動的に `RAMプレビュー` モードに切り替わります。<br>`Ctrl + R` のショートカットキーでも作成できます。
`無圧縮`<br>`通常品質`<br>`解像度1/2`<br>`解像度1/4`|キャッシュの容量と品質をコントロールするための項目です。<br>`無圧縮` - 出力されたそのままの品質で保存<br>`通常品質` - 色の再現性を犠牲に容量を 1/4 に削減<br>`解像度1/2` - 解像度を犠牲に容量を 1/16 に削減／50%サイズでのプレビュー向け<br>`解像度1/4` - 解像度を犠牲に容量を 1/64 に削減／25%サイズでのプレビュー向け<br>なお、切り替える前に作成されていたキャッシュの容量は変化しません。
`キャッシュ消去`|作成したキャッシュデータを消去します。<br>消去後は自動的に `通常` モードに切り替わります。<br>`Ctrl + E` のショートカットキーでも消去できます。

1. **範囲を指定する**  
書き出し範囲を指定する時と同じように範囲選択をします。  
例えば拡張編集上で始点としたい場所にカーソルを置き、終点にしたい場所を `Shift + クリック` で範囲選択できます。  
どのぐらいのフレーム数でどのぐらいの容量になるのかのおおよその目安をつけるために、最初は短い範囲にするのを推奨します。
2. **`選択範囲からキャッシュ作成` を押す**  
`拡張編集RAMプレビュー` の設定ダイアログにある `選択範囲からキャッシュ作成` ボタンを押すか、`Ctrl + R` を押して、キャッシュの作成を開始します。  
これには時間がかかりますが、ESC キーを押すと任意のタイミングでキャンセルすることができます。
3. **プレビューする**  
完了すると、キャッシュを作成した区間のみ映像や音声が出る `RAMプレビュー` モードになります。  
この状態でプレビューの再生を行うとメモリ上に保存された映像から再生されるため、作成中の動画の内容に関係なく一定の負荷でプレビューすることができます。
4. **キャッシュを消去する**  
確認が終わったあとは `キャッシュ消去` ボタンを押してメモリを専有しているキャッシュデータを消去します。  
キャッシュの消去を行うと自動的に `通常` モードに戻ります。