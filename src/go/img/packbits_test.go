package img

import (
	"bytes"
	"testing"
)

var packBitsTestData = [][2][]byte{
	{nil, {}},
	{{}, {}},
	{{0x03}, {0xff, 0x03}},

	{{0x03, 0x03}, {0x02, 0x03}},
	{{0x03, 0x04}, {0xfe, 0x03, 0x04}},

	{{0x03, 0x03, 0x03}, {0x03, 0x03}},
	{{0x03, 0x04, 0x05}, {0xfd, 0x03, 0x04, 0x05}},

	{{0x03, 0x03, 0x03, 0x03}, {0x04, 0x03}},
	{{0x03, 0x04, 0x05, 0x06}, {0xfc, 0x03, 0x04, 0x05, 0x06}},

	{{0x03, 0x03, 0x04, 0x04}, {0x02, 0x03, 0x02, 0x04}},
	{{0x03, 0x03, 0x04, 0x05}, {0x02, 0x03, 0xfe, 0x04, 0x05}},
	{{0x03, 0x04, 0x05, 0x05}, {0xfe, 0x03, 0x04, 0x02, 0x05}},

	{{0x03, 0x04, 0x05, 0x05, 0x06, 0x07}, {0xfe, 0x03, 0x04, 0x02, 0x05, 0xfe, 0x06, 0x07}},
	{{0x03, 0x03, 0x04, 0x05, 0x06, 0x06}, {0x02, 0x03, 0xfe, 0x04, 0x05, 0x02, 0x06}},
}

func TestEncodePackBits(t *testing.T) {
	for _, testData := range packBitsTestData {
		got := encodePackBits(testData[0])
		if !bytes.Equal(got, testData[1]) {
			t.Errorf("encodePackBits(%q) == %q, want %q", testData[0], got, testData[1])
		}
	}
}

func TestDecodePackBits(t *testing.T) {
	for _, testData := range packBitsTestData {
		got, err := decodePackBits(testData[1])
		if err != nil {
			t.Fatal(err)
		}
		if !bytes.Equal(got, testData[0]) {
			t.Errorf("decodePackBits(%q) == %q, want %q", testData[1], got, testData[0])
		}
	}
}
